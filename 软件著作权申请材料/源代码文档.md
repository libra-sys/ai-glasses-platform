# 源代码文档（前30页）

## 第1页

```typescript
// 文件名: src/App.tsx
// AI眼镜组件发布平台 V0.0.1 第1页

import { BrowserRouter as Router, Routes, Route, Navigate, useLocation } from 'react-router-dom';
import { useEffect } from 'react';
import { Toaster } from 'sonner';
import { AuthProvider } from '@/components/auth/AuthProvider';
import { RequireAuth } from '@/components/auth/RequireAuth';
import Header from '@/components/common/Header';
import Footer from '@/components/common/Footer';
import routes from './routes';

function ScrollToTop() {
  const { pathname } = useLocation();

  useEffect(() => {
    window.scrollTo(0, 0);
  }, [pathname]);

  return null;
}

function App() {
  return (
    <Router>
      <AuthProvider>
        <ScrollToTop />
        <Toaster position="top-center" richColors />
        <RequireAuth whiteList={['/', '/components', '/components/:id', '/ai-tools', '/login']}>
          <div className="flex flex-col min-h-screen">
            <Header />
            <main className="flex-grow">
              <Routes>
                {routes.map((route, index) => (
                  <Route
                    key={index}
                    path={route.path}
                    element={route.element}
                  />
                ))}
                <Route path="*" element={<Navigate to="/" replace />} />
              </Routes>
            </main>
            <Footer />
          </div>
        </RequireAuth>
      </AuthProvider>
    </Router>
  );
}

export default App;
```

## 第2页

```typescript
// 文件名: src/routes.tsx
// AI眼镜组件发布平台 V0.0.1 第2页

import type { ReactNode } from 'react';
import Home from './pages/Home';
import Components from './pages/Components';
import ComponentDetail from './pages/ComponentDetail';
import Publish from './pages/Publish';
import Profile from './pages/Profile';
import AITools from './pages/AITools';
import Admin from './pages/Admin';
import Login from './pages/Login';
import DevDoc from './pages/DevDoc';

export interface RouteConfig {
  name: string;
  path: string;
  element: ReactNode;
  visible?: boolean;
}

const routes: RouteConfig[] = [
  {
    name: '首页',
    path: '/',
    element: <Home />,
    visible: false
  },
  {
    name: '组件库',
    path: '/components',
    element: <Components />
  },
  {
    name: '组件详情',
    path: '/components/:id',
    element: <ComponentDetail />,
    visible: false
  },
  {
    name: '发布组件',
    path: '/publish',
    element: <Publish />,
    visible: false
  },
  {
    name: '个人中心',
    path: '/profile',
    element: <Profile />,
    visible: false
  },
  {
    name: 'AI助手',
    path: '/ai-tools',
    element: <AITools />
  },
  {
    name: '开发文档',
    path: '/dev-doc',
    element: <DevDoc />
  },
  {
    name: '管理后台',
    path: '/admin',
    element: <Admin />,
    visible: false
  },
  {
    name: '登录',
    path: '/login',
    element: <Login />,
    visible: false
  }
];

export default routes;
```

## 第3页

```typescript
// 文件名: src/db/api.ts
// AI眼镜组件发布平台 V0.0.1 第3页

import { supabase } from './supabase';
import type { Profile, Component, Comment, Favorite, ComponentWithAuthor, CommentWithUser, Announcement, AnnouncementWithAuthor } from '@/types/types';

export const profilesApi = {
  async getProfile(userId: string): Promise<Profile | null> {
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .eq('id', userId)
      .maybeSingle();
    
    if (error) throw error;
    return data;
  },

  async getProfileByUsername(username: string): Promise<Profile | null> {
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .eq('username', username)
      .maybeSingle();
    
    if (error) throw error;
    return data;
  },

  async updateProfile(userId: string, updates: Partial<Profile>): Promise<Profile> {
    const { data, error } = await supabase
      .from('profiles')
      .update(updates)
      .eq('id', userId)
      .select()
      .maybeSingle();
    
    if (error) throw error;
    if (!data) throw new Error('更新失败');
    return data;
  },

  async getAllProfiles(): Promise<Profile[]> {
    const { data, error } = await supabase
      .from('profiles')
      .select('*')
      .order('created_at', { ascending: false });
    
    if (error) throw error;
    return Array.isArray(data) ? data : [];
  }
};
```

## 第4页

```typescript
// 文件名: src/db/api.ts (续)
// AI眼镜组件发布平台 V0.0.1 第4页

export const componentsApi = {
  async getComponents(filters: {
    status?: string;
    search?: string;
    category?: string;
    pageSize?: number;
    page?: number;
  } = {}): Promise<ComponentWithAuthor[]> {
    let query = supabase
      .from('components')
      .select('*, author:profiles(*)')
      .order('created_at', { ascending: false });

    if (filters.status) {
      query = query.eq('status', filters.status);
    }

    if (filters.search) {
      query = query.ilike('name', `%${filters.search}%`)
        .or(`ilike(description, %${filters.search}%)`);
    }

    if (filters.category) {
      query = query.eq('category', filters.category);
    }

    if (filters.pageSize) {
      query = query.limit(filters.pageSize);
    }

    if (filters.page && filters.pageSize) {
      const offset = (filters.page - 1) * filters.pageSize;
      query = query.offset(offset);
    }

    const { data, error } = await query;
    if (error) throw error;
    return Array.isArray(data) ? data : [];
  },

  async getComponentById(id: string): Promise<ComponentWithAuthor | null> {
    const { data, error } = await supabase
      .from('components')
      .select('*, author:profiles(*)')
      .eq('id', id)
      .maybeSingle();
    if (error) throw error;
    return data;
  },

  async createComponent(component: Omit<Component, 'id' | 'created_at' | 'updated_at'>): Promise<Component> {
    const { data, error } = await supabase
      .from('components')
      .insert(component)
      .select()
      .single();
    if (error) throw error;
    return data;
  }
};
```

## 第5页

```typescript
// 文件名: src/db/api.ts (续)
// AI眼镜组件发布平台 V0.0.1 第5页

componentsApi.updateComponent = async (id: string, updates: Partial<Component>): Promise<Component> => {
  const { data, error } = await supabase
    .from('components')
    .update(updates)
    .eq('id', id)
    .select()
    .single();
  if (error) throw error;
  return data;
};

componentsApi.deleteComponent = async (id: string): Promise<void> => {
  const { error } = await supabase
    .from('components')
    .delete()
    .eq('id', id);
  if (error) throw error;
};

componentsApi.getCategories = async (): Promise<string[]> => {
  const { data, error } = await supabase
    .from('components')
    .select('category')
    .distinct('category');
  if (error) throw error;
  return (Array.isArray(data) ? data : []).map(item => item.category).filter(Boolean);
};

componentsApi.getUserComponents = async (userId: string): Promise<Component[]> => {
  const { data, error } = await supabase
    .from('components')
    .select('*')
    .eq('author_id', userId)
    .order('created_at', { ascending: false });
  if (error) throw error;
  return Array.isArray(data) ? data : [];
};
```

## 第6页

```typescript
// 文件名: src/pages/Home.tsx
// AI眼镜组件发布平台 V0.0.1 第6页

import { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { ComponentCard } from '@/components/common/ComponentCard';
import { componentsApi } from '@/db/api';
import type { ComponentWithAuthor } from '@/types/types';
import { Badge } from '@/components/ui/badge';
import { Card } from '@/components/ui/card';
import { CardContent } from '@/components/ui/card';
import { CardFooter } from '@/components/ui/card';
import { CardHeader } from '@/components/ui/card';
import { CardTitle } from '@/components/ui/card';

export default function Home() {
  const [featuredComponents, setFeaturedComponents] = useState<ComponentWithAuthor[]>([]);
  const [latestComponents, setLatestComponents] = useState<ComponentWithAuthor[]>([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadData();
  }, []);

  const loadData = async () => {
    setLoading(true);
    try {
      // 获取精选组件
      const featured = await componentsApi.getComponents({
        status: 'approved',
        pageSize: 6
      });
      setFeaturedComponents(featured);

      // 获取最新组件
      const latest = await componentsApi.getComponents({
        status: 'approved',
        pageSize: 8
      });
      setLatestComponents(latest);
    } catch (error) {
      console.error('加载组件失败:', error);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-background">
      {/* 头部横幅 */}
      <div className="relative overflow-hidden bg-primary py-20 px-4 sm:px-6 lg:px-8">
        <div className="absolute inset-0 bg-gradient-to-r from-primary/90 to-primary-foreground/20 z-0"></div>
        <div className="relative max-w-7xl mx-auto text-center">
          <h1 className="text-4xl font-bold text-primary-foreground mb-4">
            AI眼镜组件发布平台
          </h1>
          <p className="text-xl text-primary-foreground/80 max-w-2xl mx-auto mb-8">
            探索、分享和发布专为AI眼镜设计的创新组件，打造下一代智能穿戴体验
          </p>
          <div className="flex flex-wrap justify-center gap-4">
            <Link to="/components" className="btn btn-lg bg-primary-foreground text-primary hover:bg-primary-foreground/90">
              浏览组件库
            </Link>
            <Link to="/publish" className="btn btn-lg bg-transparent border-2 border-primary-foreground text-primary-foreground hover:bg-primary-foreground/10">
              发布组件
            </Link>
          </div>
        </div>
      </div>// 文件名: src/db/api.ts (续)
// AI眼镜组件发布平台 V0.0.1 第4页

export const componentsApi = {
  async getComponents(filters?: {
    status?: string;
    category?: string;
    authorId?: string;
    search?: string;
    page?: number;
    pageSize?: number;
  }): Promise<ComponentWithAuthor[]> {
    let query = supabase
      .from('components')
      .select(`
        *,
        author:profiles(*)
      `);

    if (filters?.status) {
      query = query.eq('status', filters.status);
    }
    if (filters?.category && filters.category !== 'all') {
      query = query.eq('category', filters.category);
    }
    if (filters?.authorId) {
      query = query.eq('author_id', filters.authorId);
    }
    if (filters?.search) {
      query = query.or(`name.ilike.%${filters.search}%,description.ilike.%${filters.search}%`);
    }

    const page = filters?.page || 1;
    const pageSize = filters?.pageSize || 12;
    const from = (page - 1) * pageSize;
    const to = from + pageSize - 1;

    query = query
      .order('created_at', { ascending: false })
      .range(from, to);

    const { data, error } = await query;
    
    if (error) throw error;
    return Array.isArray(data) ? data : [];
  },

  async getComponent(id: string): Promise<ComponentWithAuthor | null> {
    const { data, error } = await supabase
      .from('components')
      .select(`
        *,
        author:profiles(*)
      `)
      .eq('id', id)
      .maybeSingle();
    
    if (error) throw error;
    return data;
  },

  async createComponent(component: Omit<Component, 'id' | 'created_at' | 'updated_at'>): Promise<Component> {
    const { data, error } = await supabase
      .from('components')
      .insert(component)
      .select()
      .single();
    
    if (error) throw error;
    return data;
  },

  async updateComponent(id: string, updates: Partial<Component>): Promise<Component> {
    const { data, error } = await supabase
      .from('components')
      .update(updates)
      .eq('id', id)
      .select()
      .single();
    
    if (error) throw error;
    return data;
  }
};
```

## 第5页

```typescript
// 文件名: src/components/auth/AuthProvider.tsx
// AI眼镜组件发布平台 V0.0.1 第5页

import { createContext, useContext, useEffect, useState, type ReactNode } from 'react';
import { supabase } from '@/db/supabase';
import type { User, Session } from '@supabase/supabase-js';
import type { Profile } from '@/types/types';
import { profilesApi } from '@/db/api';

interface AuthContextType {
  user: User | null;
  profile: Profile | null;
  session: Session | null;
  loading: boolean;
  signIn: (username: string, password: string) => Promise<void>;
  signUp: (username: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;
  refreshProfile: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export function AuthProvider({ children }: { children: ReactNode }) {
  const [user, setUser] = useState<User | null>(null);
  const [profile, setProfile] = useState<Profile | null>(null);
  const [session, setSession] = useState<Session | null>(null);
  const [loading, setLoading] = useState(true);

  const refreshProfile = async () => {
    if (user) {
      try {
        const profileData = await profilesApi.getProfile(user.id);
        setProfile(profileData);
      } catch (error) {
        console.error('获取用户资料失败:', error);
      }
    }
  };

  useEffect(() => {
    supabase.auth.getSession().then(({ data: { session } }) => {
      setSession(session);
      setUser(session?.user ?? null);
      
      if (session?.user) {
        profilesApi.getProfile(session.user.id).then(profileData => {
          setProfile(profileData);
          setLoading(false);
        }).catch(() => {
          setLoading(false);
        });
      } else {
        setLoading(false);
      }
    });

    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {
      setSession(session);
      setUser(session?.user ?? null);
      
      if (session?.user) {
        profilesApi.getProfile(session.user.id).then(profileData => {
          setProfile(profileData);
        });
      } else {
        setProfile(null);
      }
    });

    return () => subscription.unsubscribe();
  }, []);

  const signIn = async (username: string, password: string) => {
    const email = `${username}@aiglasses.local`;
    const { error } = await supabase.auth.signInWithPassword({
      email,
      password
    });
    
    if (error) throw error;
  };
```

## 第6页

```typescript
// 文件名: src/components/auth/AuthProvider.tsx (续)
// AI眼镜组件发布平台 V0.0.1 第6页

  const signUp = async (username: string, password: string) => {
    const email = `${username}@aiglasses.local`;
    const { error } = await supabase.auth.signUp({
      email,
      password
    });
    
    if (error) throw error;
  };

  const signOut = async () => {
    const { error } = await supabase.auth.signOut();
    if (error) throw error;
  };

  return (
    <AuthContext.Provider value={{ user, profile, session, loading, signIn, signUp, signOut, refreshProfile }}>
      {children}
    </AuthContext.Provider>
  );
}

export function useAuth() {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
}
```

## 第7页

```typescript
// 文件名: src/pages/Home.tsx
// AI眼镜组件发布平台 V0.0.1 第7页

import { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import { Search, TrendingUp, Sparkles, Upload, BookOpen, Megaphone } from 'lucide-react';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Badge } from '@/components/ui/badge';
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert';
import { Dialog, DialogContent, DialogDescription, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';
import { ComponentCard } from '@/components/common/ComponentCard';
import { componentsApi, announcementsApi } from '@/db/api';
import type { ComponentWithAuthor, AnnouncementWithAuthor } from '@/types/types';

export default function Home() {
  const [components, setComponents] = useState<ComponentWithAuthor[]>([]);
  const [announcements, setAnnouncements] = useState<AnnouncementWithAuthor[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState('');

  useEffect(() => {
    loadComponents();
    loadAnnouncements();
  }, []);

  const loadAnnouncements = async () => {
    try {
      const data = await announcementsApi.getAnnouncements(true);
      setAnnouncements(data.slice(0, 3));
    } catch (error: any) {
      console.error('加载公告失败:', error);
    }
  };

  const loadComponents = async () => {
    try {
      const data = await componentsApi.getComponents({
        status: 'approved',
        pageSize: 6
      });
      setComponents(data);
    } catch (error: any) {
      console.error('加载组件失败:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleSearch = () => {
    if (searchQuery.trim()) {
      window.location.href = `/components?search=${encodeURIComponent(searchQuery)}`;
    }
  };
```

## 第8页

```typescript
// 文件名: src/pages/Home.tsx (续)
// AI眼镜组件发布平台 V0.0.1 第8页

  return (
    <div className="min-h-screen">
      <section className="bg-gradient-to-br from-primary/10 via-accent/5 to-background py-20">
        <div className="container mx-auto px-4">
          <div className="max-w-3xl mx-auto text-center space-y-6">
            <h1 className="text-4xl md:text-5xl font-bold text-foreground">
              AI眼镜组件发布平台
            </h1>
            <p className="text-xl text-muted-foreground">
              专为蓝牙智能AI眼镜用户打造的组件发布与分享平台
            </p>
            <div className="flex gap-2 max-w-xl mx-auto">
              <Input
                placeholder="搜索组件..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                className="flex-1"
              />
              <Button onClick={handleSearch}>
                <Search className="h-4 w-4 mr-2" />
                搜索
              </Button>
            </div>
            <div className="flex gap-4 justify-center pt-4 flex-wrap">
              <Button asChild size="lg">
                <Link to="/components">
                  <TrendingUp className="h-5 w-5 mr-2" />
                  浏览组件
                </Link>
              </Button>
              <Button asChild size="lg" variant="outline">
                <Link to="/publish">
                  <Upload className="h-5 w-5 mr-2" />
                  发布组件
                </Link>
              </Button>
              <Dialog>
                <DialogTrigger asChild>
                  <Button size="lg" variant="secondary">
                    <BookOpen className="h-5 w-5 mr-2" />
                    开发文档
                  </Button>
                </DialogTrigger>
                <DialogContent className="max-w-2xl">
                  <DialogHeader>
                    <DialogTitle>AI眼镜组件开发文档</DialogTitle>
                    <DialogDescription>
                      详细了解如何开发和发布AI眼镜组件
                    </DialogDescription>
                  </DialogHeader>
                  <div className="prose max-w-none">
                    <p>
                      欢迎使用AI眼镜组件发布平台！本平台支持开发者创建、发布和分享各种AI眼镜相关组件。
                    </p>
                    <h3>开始开发</h3>
                    <p>
                      要开始开发AI眼镜组件，请先注册账户，然后阅读完整的开发指南。
                    </p>
                  </div>
                </DialogContent>
              </Dialog>
            </div>
          </div>
        </div>
      </section>
```

## 第9页

```typescript
// 文件名: src/pages/Home.tsx (续)
// AI眼镜组件发布平台 V0.0.1 第9页

      <section className="py-12 bg-muted/30">
        <div className="container mx-auto px-4">
          <h2 className="text-2xl font-bold text-foreground mb-8">精选组件</h2>
          {loading ? (
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              {Array.from({ length: 6 }).map((_, index) => (
                <div key={index} className="p-6 border rounded-lg animate-pulse">
                  <div className="h-4 bg-muted rounded w-3/4 mb-4"></div>
                  <div className="h-3 bg-muted rounded w-full mb-2"></div>
                  <div className="h-3 bg-muted rounded w-5/6 mb-2"></div>
                  <div className="flex justify-between items-center mt-6">
                    <div className="h-4 bg-muted rounded w-1/4"></div>
                    <div className="h-8 bg-muted rounded w-24"></div>
                  </div>
                </div>
              ))}
            </div>
          ) : (
            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
              {components.map((component) => (
                <ComponentCard key={component.id} component={component} />
              ))}
              {components.length === 0 && (
                <div className="col-span-full text-center py-12">
                  <p className="text-muted-foreground">暂无精选组件</p>
                </div>
              )}
            </div>
          )}
          {components.length > 0 && (
            <div className="text-center mt-8">
              <Button asChild>
                <Link to="/components">查看全部组件</Link>
              </Button>
            </div>
          )}
        </div>
      </section>

      <section className="py-12">
        <div className="container mx-auto px-4">
          <h2 className="text-2xl font-bold text-foreground mb-8 flex items-center">
            <Megaphone className="h-5 w-5 mr-2" />
            最新公告
          </h2>
          {announcements.length > 0 ? (
            <div className="space-y-4">
              {announcements.map((announcement) => (
                <Alert key={announcement.id} variant="default">
                  <AlertTitle>{announcement.title}</AlertTitle>
                  <AlertDescription className="mt-1">
                    {announcement.content}
                  </AlertDescription>
                  <div className="mt-2 text-sm text-muted-foreground">
                    发布时间: {new Date(announcement.created_at).toLocaleDateString()}
                  </div>
                </Alert>
              ))}
            </div>
          ) : (
            <p className="text-muted-foreground">暂无公告</p>
          )}
        </div>
      </section>
    </div>
  );
}
```

## 第10页

```typescript
// 文件名: src/pages/Components.tsx
// AI眼镜组件发布平台 V0.0.1 第10页

import { useEffect, useState } from 'react';
import { useSearchParams } from 'react-router-dom';
import { Search, Filter } from 'lucide-react';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { ComponentCard } from '@/components/common/ComponentCard';
import { componentsApi } from '@/db/api';
import type { ComponentWithAuthor } from '@/types/types';
import { toast } from 'sonner';

export default function Components() {
  const [searchParams, setSearchParams] = useSearchParams();
  const [components, setComponents] = useState<ComponentWithAuthor[]>([]);
  const [categories, setCategories] = useState<string[]>([]);
  const [loading, setLoading] = useState(true);
  const [searchQuery, setSearchQuery] = useState(searchParams.get('search') || '');
  const [selectedCategory, setSelectedCategory] = useState(searchParams.get('category') || 'all');

  useEffect(() => {
    loadCategories();
  }, []);

  useEffect(() => {
    loadComponents();
  }, [searchParams]);

  const loadCategories = async () => {
    try {
      const data = await componentsApi.getCategories();
      setCategories(data);
    } catch (error) {
      console.error('加载分类失败:', error);
    }
  };

  const loadComponents = async () => {
    setLoading(true);
    try {
      const data = await componentsApi.getComponents({
        status: 'approved',
        search: searchParams.get('search') || undefined,
        category: searchParams.get('category') || undefined,
        pageSize: 50
      });
      setComponents(data);
    } catch (error: any) {
      console.error('加载组件失败:', error);
      toast.error('加载失败，请检查网络连接');
    } finally {
      setLoading(false);
    }
  };

  const handleSearch = () => {
    const params = new URLSearchParams();
    if (searchQuery) params.set('search', searchQuery);
    if (selectedCategory && selectedCategory !== 'all') params.set('category', selectedCategory);
    setSearchParams(params);
  };
```

## 第11页

```typescript
// 文件名: src/pages/Components.tsx (续)
// AI眼镜组件发布平台 V0.0.1 第11页

  const handleCategoryChange = (value: string) => {
    setSelectedCategory(value);
    const params = new URLSearchParams();
    if (searchQuery) params.set('search', searchQuery);
    if (value !== 'all') params.set('category', value);
    setSearchParams(params);
  };

  return (
    <div className="min-h-screen bg-background py-8">
      <div className="container mx-auto px-4">
        <h1 className="text-3xl font-bold text-foreground mb-8">组件库</h1>

        <div className="flex flex-col md:flex-row gap-4 mb-8">
          <div className="flex-1 flex gap-2">
            <Input
              placeholder="搜索组件..."
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
              className="flex-1"
            />
            <Button onClick={handleSearch}>
              <Search className="h-4 w-4 mr-2" />
              搜索
            </Button>
          </div>
          <Select value={selectedCategory} onValueChange={handleCategoryChange}>
            <SelectTrigger className="w-full md:w-48">
              <Filter className="h-4 w-4 mr-2" />
              <SelectValue placeholder="选择分类" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="all">全部分类</SelectItem>
              {categories.map((category) => (
                <SelectItem key={category} value={category}>
                  {category}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>

        {loading ? (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {Array.from({ length: 9 }).map((_, index) => (
              <div key={index} className="p-6 border rounded-lg animate-pulse">
                <div className="h-4 bg-muted rounded w-3/4 mb-4"></div>
                <div className="h-3 bg-muted rounded w-full mb-2"></div>
                <div className="h-3 bg-muted rounded w-5/6 mb-2"></div>
                <div className="flex justify-between items-center mt-6">
                  <div className="h-4 bg-muted rounded w-1/4"></div>
                  <div className="h-8 bg-muted rounded w-24"></div>
                </div>
              </div>
            ))}
          </div>
        ) : (
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            {components.map((component) => (
              <ComponentCard key={component.id} component={component} />
            ))}
            {components.length === 0 && (
              <div className="col-span-full text-center py-12">
                <p className="text-muted-foreground text-lg">未找到相关组件</p>
                <Button className="mt-4" onClick={() => setSearchParams({})}>
                  清除筛选条件
                </Button>
              </div>
            )}
          </div>
        )}
      </div>
    </div>
  );
}
```

## 第12页

```typescript
// 文件名: src/pages/AITools.tsx
// AI眼镜组件发布平台 V0.0.1 第12页

import { useState } from 'react';
import { Sparkles, Send, Image as ImageIcon } from 'lucide-react';
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { sendChatStream, generateComponentImage } from '@/lib/spark-api';
import { toast } from 'sonner';

export default function AITools() {
  const [chatMessages, setChatMessages] = useState<Array<{ role: string; content: string }>>([]);
  const [chatInput, setChatInput] = useState('');
  const [chatLoading, setChatLoading] = useState(false);
  
  const [imagePrompt, setImagePrompt] = useState('');
  const [generatedImage, setGeneratedImage] = useState('');
  const [imageLoading, setImageLoading] = useState(false);

  const handleChat = async () => {
    if (!chatInput.trim()) return;

    const userMessage = chatInput;
    setChatInput('');
    setChatMessages(prev => [...prev, { role: 'user', content: userMessage }]);
    setChatLoading(true);

    try {
      await sendChatStream({
        messages: [{ role: 'user', content: userMessage }],
        onUpdate: (content) => {
          setChatMessages(prev => {
            const newMessages = [...prev];
            if (newMessages[newMessages.length - 1]?.role === 'assistant') {
              newMessages[newMessages.length - 1].content = content;
            } else {
              newMessages.push({ role: 'assistant', content });
            }
            return newMessages;
          });
        },
        onComplete: () => {
          setChatLoading(false);
        },
        onError: (error) => {
          toast.error(error.message || 'AI对话失败');
          setChatLoading(false);
        }
      });
    } catch (error: any) {
      toast.error(error.message || 'AI对话失败');
      setChatLoading(false);
    }
  };

  const handleGenerateImage = async () => {
    if (!imagePrompt.trim()) {
      toast.error('请输入图片描述');
      return;
    }

    setImageLoading(true);
    setGeneratedImage('');
    
    try {
      toast.info('正在生成图片，请稍候...');
      const imageUrl = await generateComponentImage(imagePrompt);
      setGeneratedImage(imageUrl);
      toast.success('图片生成完成！');
    } catch (error: any) {
      console.error('图片生成失败:', error);
      toast.error(error.message || '图片生成失败，请稍后重试');
    } finally {
      setImageLoading(false);
    }
  };
```

## 第13页

```typescript
// 文件名: src/pages/AITools.tsx (续)
// AI眼镜组件发布平台 V0.0.1 第13页

  return (
    <div className="min-h-screen bg-background py-8">
      <div className="container mx-auto px-4">
        <h1 className="text-3xl font-bold text-foreground mb-8">AI助手</h1>

        <Tabs defaultValue="chat" className="w-full">
          <TabsList className="grid w-full grid-cols-2">
            <TabsTrigger value="chat">
              <Sparkles className="h-4 w-4 mr-2" />
              组件描述
            </TabsTrigger>
            <TabsTrigger value="image">
              <ImageIcon className="h-4 w-4 mr-2" />
              封面图生成
            </TabsTrigger>
          </TabsList>

          <TabsContent value="chat">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <Sparkles className="h-5 w-5" />
                  组件描述助手
                </CardTitle>
                <CardDescription>
                  输入组件相关信息，AI将帮您生成专业的组件描述
                </CardDescription>
              </CardHeader>
              <CardContent>
                <div className="h-96 border rounded-lg p-4 overflow-y-auto mb-4 bg-muted/20">
                  {chatMessages.length === 0 && (
                    <div className="text-center text-muted-foreground py-10">
                      开始与AI助手对话，获取组件描述建议
                    </div>
                  )}
                  {chatMessages.map((message, index) => (
                    <div key={index} className={`mb-4 ${message.role === 'user' ? 'text-right' : 'text-left'}`}>
                      <div className={`inline-block p-3 rounded-lg max-w-[80%] ${message.role === 'user' ? 'bg-primary/10 text-primary-foreground' : 'bg-muted'}`}>
                        {message.content}
                      </div>
                    </div>
                  ))}
                  {chatLoading && (
                    <div className="inline-block p-3 rounded-lg max-w-[80%] bg-muted animate-pulse">
                      AI正在输入...
                    </div>
                  )}
                </div>
                <div className="flex gap-2">
                  <Textarea
                    placeholder="请描述您的组件功能和特点..."
                    value={chatInput}
                    onChange={(e) => setChatInput(e.target.value)}
                    onKeyDown={(e) => e.key === 'Enter' && !e.shiftKey && handleChat()}
                    className="flex-1 resize-none"
                    rows={3}
                  />
                  <Button onClick={handleChat} disabled={chatLoading} className="h-16 self-end">
                    <Send className="h-4 w-4" />
                  </Button>
                </div>
              </CardContent>
            </Card>
          </TabsContent>

          <TabsContent value="image">
            <Card>
              <CardHeader>
                <CardTitle className="flex items-center gap-2">
                  <ImageIcon className="h-5 w-5" />
                  封面图生成
                </CardTitle>
                <CardDescription>
                  输入图片描述，生成组件封面图
                </CardDescription>
              </CardHeader>
              <CardContent>
                <Textarea
                  placeholder="请详细描述您想要的图片内容，例如：'一个未来感的智能眼镜界面，显示健康数据监测功能'"
                  value={imagePrompt}
                  onChange={(e) => setImagePrompt(e.target.value)}
                  className="mb-4 resize-none"
                  rows={4}
                />
                <Button onClick={handleGenerateImage} disabled={imageLoading} className="w-full">
                  {imageLoading ? '正在生成...' : '生成图片'}
                </Button>
                {generatedImage && (
                  <div className="mt-6">
                    <h3 className="text-lg font-medium mb-2">生成结果</h3>
                    <div className="border rounded-lg p-2 bg-muted/20 flex justify-center">
                      <img 
                        src={generatedImage} 
                        alt="生成的封面图" 
                        className="max-w-full max-h-80 object-contain"
                      />
                    </div>
                    <div className="flex justify-center mt-4">
                      <Button 
                        variant="secondary" 
                        onClick={() => {
                          const link = document.createElement('a');
                          link.href = generatedImage;
                          link.download = 'component-cover.png';
                          document.body.appendChild(link);
                          link.click();
                          document.body.removeChild(link);
                        }}
                      >
                        下载图片
                      </Button>
                    </div>
                  </div>
                )}
              </CardContent>
            </Card>
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}
```

## 第14页

```typescript
// 文件名: src/db/supabase.ts
// AI眼镜组件发布平台 V0.0.1 第14页

import { createClient } from '@supabase/supabase-js';

// 创建Supabase客户端
const supabaseUrl = import.meta.env.VITE_SUPABASE_URL || '';
const supabaseKey = import.meta.env.VITE_SUPABASE_ANON_KEY || '';

export const supabase = createClient(supabaseUrl, supabaseKey, {
  auth: {
    persistSession: true,
    autoRefreshToken: true,
    detectSessionInUrl: true,
  },
});

// 验证Supabase配置
if (!supabaseUrl || !supabaseKey) {
  console.error('Supabase配置缺失，请检查环境变量');
}
```

## 第15页

```typescript
// 文件名: src/types/types.ts
// AI眼镜组件发布平台 V0.0.1 第15页

import type { Database } from './index';

export type Profile = Database['public']['Tables']['profiles']['Row'];
export type Component = Database['public']['Tables']['components']['Row'];
export type Comment = Database['public']['Tables']['comments']['Row'];
export type Favorite = Database['public']['Tables']['favorites']['Row'];
export type Announcement = Database['public']['Tables']['announcements']['Row'];

export interface ComponentWithAuthor extends Component {
  author: Profile;
}

export interface CommentWithUser extends Comment {
  user: Profile;
}

export interface AnnouncementWithAuthor extends Announcement {
  author: Profile;
}

// 组件表单数据类型
export interface ComponentFormData {
  name: string;
  description: string;
  category: string;
  code: string;
  cover_image: string;
  demo_link?: string;
}

// 用户登录表单数据类型
export interface LoginFormData {
  username: string;
  password: string;
}

// 用户注册表单数据类型
export interface RegisterFormData {
  username: string;
  password: string;
  confirmPassword: string;
}

// 组件搜索参数类型
export interface ComponentSearchParams {
  search?: string;
  category?: string;
  page?: number;
  pageSize?: number;
}
```

## 第16页

```typescript
// 文件名: src/lib/spark-api.ts
// AI眼镜组件发布平台 V0.0.1 第16页

import axios from 'axios';
import { createParser } from 'eventsource-parser';

interface ChatMessage {
  role: string;
  content: string;
}

interface ChatStreamOptions {
  messages: ChatMessage[];
  onUpdate: (content: string) => void;
  onComplete: () => void;
  onError: (error: Error) => void;
}

// Spark API配置
const SPARK_API_URL = import.meta.env.VITE_SPARK_API_URL || '';
const SPARK_API_KEY = import.meta.env.VITE_SPARK_API_KEY || '';

// 发送流式对话请求
export async function sendChatStream(options: ChatStreamOptions) {
  const { messages, onUpdate, onComplete, onError } = options;

  try {
    // 准备请求数据
    const requestData = {
      messages: [
        {
          role: 'system',
          content: '你是一位专业的AI眼镜组件开发助手，擅长编写清晰、专业的组件描述文档。'
        },
        ...messages
      ],
      model: 'spark-pro',
      stream: true
    };

    // 发送请求
    const response = await fetch(SPARK_API_URL + '/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${SPARK_API_KEY}`
      },
      body: JSON.stringify(requestData)
    });

    if (!response.ok) {
      throw new Error(`API请求失败: ${response.status}`);
    }

    // 处理流式响应
    const parser = createParser((event) => {
      if (event.type === 'event') {
        try {
          const data = JSON.parse(event.data);
          if (data.choices && data.choices.length > 0) {
            const content = data.choices[0].message?.content || '';
            onUpdate(content);
          }
          if (data.choices && data.choices[0]?.finish_reason) {
            onComplete();
          }
        } catch (error) {
          onError(new Error('解析响应数据失败'));
        }
      }
    });

    const reader = response.body?.getReader();
    if (!reader) {
      throw new Error('无法读取响应流');
    }

    while (true) {
      const { done, value } = await reader.read();
      if (done) break;
      
      const chunk = new TextDecoder().decode(value);
      parser.feed(chunk);
    }
  } catch (error) {
    onError(error instanceof Error ? error : new Error('未知错误'));
  }
}

// 生成组件封面图片
export async function generateComponentImage(prompt: string): Promise<string> {
  try {
    const requestData = {
      prompt,
      n: 1,
      size: '1024x1024'
    };

    const response = await axios.post(
      SPARK_API_URL + '/images/generations',
      requestData,
      {
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${SPARK_API_KEY}`
        }
      }
    );

    if (response.data && response.data.data && response.data.data[0]?.url) {
      return response.data.data[0].url;
    } else {
      throw new Error('图片生成失败，未返回有效URL');
    }
  } catch (error) {
    console.error('图片生成API错误:', error);
    throw new Error('图片生成失败');
  }
}
```

## 第17页

```typescript
// 文件名: src/components/common/ComponentCard.tsx
// AI眼镜组件发布平台 V0.0.1 第17页

import { Link } from 'react-router-dom';
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
import { Badge } from '@/components/ui/badge';
import { Avatar, AvatarFallback, AvatarImage } from '@/components/ui/avatar';
import { formatDistanceToNow } from 'date-fns';
import { zhCN } from 'date-fns/locale';
import type { ComponentWithAuthor } from '@/types/types';

interface ComponentCardProps {
  component: ComponentWithAuthor;
}

export function ComponentCard({ component }: ComponentCardProps) {
  // 格式化发布时间
  const formatTime = (dateString: string) => {
    try {
      return formatDistanceToNow(new Date(dateString), { addSuffix: true, locale: zhCN });
    } catch {
      return '刚刚';
    }
  };

  return (
    <Card className="h-full flex flex-col">
      <CardHeader className="p-6 pb-4">
        <div className="flex justify-between items-start mb-2">
          <Badge variant="outline" className="font-normal">
            {component.category}
          </Badge>
          <span className="text-sm text-muted-foreground">
            {formatTime(component.created_at)}
          </span>
        </div>
        <CardTitle className="text-xl line-clamp-2">
          <Link to={`/components/${component.id}`} className="hover:text-primary transition-colors">
            {component.name}
          </Link>
        </CardTitle>
        <CardDescription className="line-clamp-2">
          {component.description}
        </CardDescription>
      </CardHeader>
      <CardContent className="flex-grow p-6 pt-0">
        {component.cover_image && (
          <div className="w-full h-40 overflow-hidden rounded-md bg-muted/20 mb-4">
            <img
              src={component.cover_image}
              alt={component.name}
              className="w-full h-full object-cover transition-transform hover:scale-105"
            />
          </div>
        )}
      </CardContent>
      <CardFooter className="p-6 pt-0 flex justify-between items-center">
        <div className="flex items-center gap-2">
          <Avatar className="h-8 w-8">
            <AvatarImage src={component.author.avatar_url} alt={component.author.username} />
            <AvatarFallback>{component.author.username.slice(0, 2).toUpperCase()}</AvatarFallback>
          </Avatar>
          <span className="text-sm font-medium">{component.author.username}</span>
        </div>
        <Link to={`/components/${component.id}`} className="text-sm text-primary hover:underline">
          查看详情
        </Link>
      </CardFooter>
    </Card>
  );
}
```

## 第18页

```typescript
// 文件名: src/pages/Publish.tsx
// AI眼镜组件发布平台 V0.0.1 第18页

import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { zodResolver } from '@hookform/resolvers/zod';
import { useForm } from 'react-hook-form';
import { z } from 'zod';
import { Button } from '@/components/ui/button';
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';
import { Textarea } from '@/components/ui/textarea';
import { toast } from 'sonner';
import { componentsApi } from '@/db/api';
import { useAuth } from '@/components/auth/AuthProvider';
import { ComponentFormData } from '@/types/types';

// 表单验证模式
const formSchema = z.object({
  name: z.string().min(1, '请输入组件名称').max(100, '组件名称不能超过100个字符'),
  description: z.string().min(1, '请输入组件描述').max(500, '组件描述不能超过500个字符'),
  category: z.string().min(1, '请选择组件分类'),
  code: z.string().min(1, '请输入组件代码'),
  cover_image: z.string().min(1, '请输入封面图URL'),
  demo_link: z.string().optional().url('请输入有效的演示链接'),
});

type FormSchema = z.infer<typeof formSchema>;

export default function Publish() {
  const navigate = useNavigate();
  const { user } = useAuth();
  const [loading, setLoading] = useState(false);
  const [categories, setCategories] = useState<string[]>([
    '工具类',
    '健康监测',
    '信息展示',
    '娱乐休闲',
    '生产力',
    '其他'
  ]);

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<FormSchema>({
    resolver: zodResolver(formSchema),
    defaultValues: {
      name: '',
      description: '',
      category: '',
      code: '',
      cover_image: '',
      demo_link: '',
    },
  });

  const onSubmit = async (data: FormSchema) => {
    if (!user) {
      toast.error('请先登录');
      navigate('/login');
      return;
    }

    setLoading(true);
    
    try {
      // 准备组件数据
      const componentData: Omit<ComponentFormData, 'confirmName'> = {
        name: data.name,
        description: data.description,
        category: data.category,
        code: data.code,
        cover_image: data.cover_image,
        demo_link: data.demo_link,
      };

      // 调用API创建组件
      await componentsApi.createComponent({
        ...componentData,
        author_id: user.id,
        status: 'pending',
        view_count: 0,
        favorite_count: 0,
      });

      toast.success('组件发布成功，等待审核');
      navigate('/components');
    } catch (error: any) {
      console.error('发布组件失败:', error);
      toast.error('发布失败：' + (error.message || '请稍后重试'));
    } finally {
      setLoading(false);
    }
  };
```

## 第19页

```typescript
// 文件名: src/pages/Publish.tsx (续)
// AI眼镜组件发布平台 V0.0.1 第19页

  return (
    <div className="min-h-screen bg-background py-8">
      <div className="container mx-auto px-4">
        <h1 className="text-3xl font-bold text-foreground mb-8">发布组件</h1>
        
        <Card className="max-w-3xl mx-auto">
          <CardHeader>
            <CardTitle>创建新组件</CardTitle>
            <CardDescription>
              请填写组件的详细信息，提交后将进入审核流程
            </CardDescription>
          </CardHeader>
          <CardContent>
            <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
              <div className="space-y-2">
                <Label htmlFor="name">组件名称</Label>
                <Input
                  id="name"
                  placeholder="请输入组件名称"
                  {...register('name')}
                  className={errors.name ? 'border-destructive' : ''}
                />
                {errors.name && (
                  <p className="text-destructive text-sm">{errors.name.message}</p>
                )}
              </div>

              <div className="space-y-2">
                <Label htmlFor="description">组件描述</Label>
                <Textarea
                  id="description"
                  placeholder="请详细描述组件的功能和用途"
                  rows={4}
                  {...register('description')}
                  className={errors.description ? 'border-destructive' : ''}
                />
                {errors.description && (
                  <p className="text-destructive text-sm">{errors.description.message}</p>
                )}
              </div>

              <div className="space-y-2">
                <Label htmlFor="category">组件分类</Label>
                <Select {...register('category')}>
                  <SelectTrigger className={errors.category ? 'border-destructive' : ''}>
                    <SelectValue placeholder="选择组件分类" />
                  </SelectTrigger>
                  <SelectContent>
                    {categories.map((category) => (
                      <SelectItem key={category} value={category}>
                        {category}
                      </SelectItem>
                    ))}
                  </SelectContent>
                </Select>
                {errors.category && (
                  <p className="text-destructive text-sm">{errors.category.message}</p>
                )}
              </div>

              <div className="space-y-2">
                <Label htmlFor="code">组件代码</Label>
                <Textarea
                  id="code"
                  placeholder="请输入组件的源代码"
                  rows={10}
                  {...register('code')}
                  className={errors.code ? 'border-destructive' : ''}
                />
                {errors.code && (
                  <p className="text-destructive text-sm">{errors.code.message}</p>
                )}
              </div>

              <div className="space-y-2">
                <Label htmlFor="cover_image">封面图URL</Label>
                <Input
                  id="cover_image"
                  placeholder="请输入组件封面图的URL地址"
                  {...register('cover_image')}
                  className={errors.cover_image ? 'border-destructive' : ''}
                />
                {errors.cover_image && (
                  <p className="text-destructive text-sm">{errors.cover_image.message}</p>
                )}
                <p className="text-xs text-muted-foreground">
                  您可以使用AI助手生成封面图，然后将图片URL粘贴到此处
                </p>
              </div>

              <div className="space-y-2">
                <Label htmlFor="demo_link">演示链接 (可选)</Label>
                <Input
                  id="demo_link"
                  placeholder="请输入组件演示链接"
                  {...register('demo_link')}
                  className={errors.demo_link ? 'border-destructive' : ''}
                />
                {errors.demo_link && (
                  <p className="text-destructive text-sm">{errors.demo_link.message}</p>
                )}
              </div>
            </form>
          </CardContent>
          <CardFooter>
            <Button 
              type="submit" 
              onClick={handleSubmit(onSubmit)}
              disabled={loading}
              className="w-full"
            >
              {loading ? '发布中...' : '发布组件'}
            </Button>
          </CardFooter>
        </Card>
      </div>
    </div>
  );
}
```

## 第20页

```typescript
// 文件名: src/components/auth/RequireAuth.tsx
// AI眼镜组件发布平台 V0.0.1 第20页

import { useEffect } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import { useAuth } from './AuthProvider';
import type { ReactNode } from 'react';

interface RequireAuthProps {
  children: ReactNode;
  whiteList?: string[];
  requireAdmin?: boolean;
}

export function RequireAuth({ children, whiteList = [], requireAdmin = false }: RequireAuthProps) {
  const { user, profile, loading } = useAuth();
  const navigate = useNavigate();
  const location = useLocation();

  useEffect(() => {
    // 如果正在加载，不做任何操作
    if (loading) return;

    // 检查当前路径是否在白名单中
    const isInWhiteList = whiteList.some((path) => {
      if (path.includes(':')) {
        // 处理带参数的路由
        const pathRegex = new RegExp(`^${path.replace(/:([^/]+)/g, '[^/]+')}$`);
        return pathRegex.test(location.pathname);
      }
      return location.pathname === path;
    });

    // 如果在白名单中，允许访问
    if (isInWhiteList) return;

    // 如果未登录，重定向到登录页面
    if (!user) {
      navigate('/login', { state: { from: location } });
      return;
    }

    // 如果需要管理员权限，检查用户是否为管理员
    if (requireAdmin && (!profile || !profile.is_admin)) {
      navigate('/');
      return;
    }
  }, [user, profile, loading, navigate, location, whiteList, requireAdmin]);

  return <>{children}</>;
}
```

## 第21页

```typescript
// 文件名: src/lib/utils.ts
// AI眼镜组件发布平台 V0.0.1 第21页

import { clsx, type ClassValue } from 'clsx';
import { twMerge } from 'tailwind-merge';

/**
 * 合并CSS类名的工具函数
 */
export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

/**
 * 格式化文件大小
 */
export function formatFileSize(bytes: number): string {
  if (bytes === 0) return '0 Bytes';
  
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
}

/**
 * 验证URL是否有效
 */
export function isValidUrl(url: string): boolean {
  try {
    new URL(url);
    return true;
  } catch {
    return false;
  }
}

/**
 * 截断文本，超过指定长度时添加省略号
 */
export function truncateText(text: string, maxLength: number): string {
  if (text.length <= maxLength) return text;
  return text.slice(0, maxLength) + '...';
}

/**
 * 生成唯一ID
 */
export function generateId(): string {
  return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

/**
 * 延迟函数
 */
export function delay(ms: number): Promise<void> {
  return new Promise(resolve => setTimeout(resolve, ms));
}

/**
 * 防抖函数
 */
export function debounce<T extends (...args: any[]) => any>(
  func: T,
  wait: number
): (...args: Parameters<T>) => void {
  let timeout: ReturnType<typeof setTimeout> | null = null;
  
  return (...args: Parameters<T>) => {
    if (timeout) clearTimeout(timeout);
    timeout = setTimeout(() => func(...args), wait);
  };
}

/**
 * 节流函数
 */
export function throttle<T extends (...args: any[]) => any>(
  func: T,
  limit: number
): (...args: Parameters<T>) => void {
  let inThrottle: boolean = false;
  
  return (...args: Parameters<T>) => {
    if (!inThrottle) {
      func(...args);
      inThrottle = true;
      setTimeout(() => inThrottle = false, limit);
    }
  };
}

/**
 * 复制文本到剪贴板
 */
export async function copyToClipboard(text: string): Promise<boolean> {
  try {
    await navigator.clipboard.writeText(text);
    return true;
  } catch (error) {
    console.error('复制失败:', error);
    return false;
  }
}

/**
 * 检查是否为移动设备
 */
export function isMobileDevice(): boolean {
  return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

/**
 * 安全地解析JSON字符串
 */
export function safeJsonParse<T>(jsonString: string, defaultValue: T): T {
  try {
    return JSON.parse(jsonString) as T;
  } catch (error) {
    console.error('解析JSON失败:', error);
    return defaultValue;
  }
}

/**
 * 获取文件扩展名
 */
export function getFileExtension(filename: string): string {
  const parts = filename.split('.');
  return parts.length > 1 ? parts[parts.length - 1].toLowerCase() : '';
}
```

## 第22页

```typescript
// 文件名: src/pages/Login.tsx
// AI眼镜组件发布平台 V0.0.1 第22页

import { useState } from 'react';
import { useNavigate, useLocation } from 'react-router-dom';
import { zodResolver } from '@hookform/resolvers/zod';
import { useForm } from 'react-hook-form';
import { z } from 'zod';
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card';
import { Input } from '@/components/ui/input';
import { Label } from '@/components/ui/label';
import { Button } from '@/components/ui/button';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { toast } from 'sonner';
import { useAuth } from '@/components/auth/AuthProvider';
import { cn } from '@/lib/utils';

// 登录表单验证模式
const loginSchema = z.object({
  username: z.string().min(1, '请输入用户名'),
  password: z.string().min(1, '请输入密码'),
});

// 注册表单验证模式
const registerSchema = z.object({
  username: z.string().min(3, '用户名至少需要3个字符').max(20, '用户名最多20个字符'),
  password: z.string().min(6, '密码至少需要6个字符'),
  confirmPassword: z.string().min(1, '请确认密码'),
}).refine((data) => data.password === data.confirmPassword, {
  message: '两次输入的密码不一致',
  path: ['confirmPassword'],
});

type LoginFormData = z.infer<typeof loginSchema>;
type RegisterFormData = z.infer<typeof registerSchema>;

export default function Login() {
  const navigate = useNavigate();
  const location = useLocation();
  const { signIn, signUp } = useAuth();
  const [activeTab, setActiveTab] = useState('login');
  const [loading, setLoading] = useState(false);

  const loginForm = useForm<LoginFormData>({
    resolver: zodResolver(loginSchema),
    defaultValues: {
      username: '',
      password: '',
    },
  });

  const registerForm = useForm<RegisterFormData>({
    resolver: zodResolver(registerSchema),
    defaultValues: {
      username: '',
      password: '',
      confirmPassword: '',
    },
  });

  const handleLogin = async (data: LoginFormData) => {
    setLoading(true);
    try {
      await signIn(data.username, data.password);
      toast.success('登录成功');
      // 重定向到之前的页面或首页
      const from = location.state?.from?.pathname || '/';
      navigate(from, { replace: true });
    } catch (error: any) {
      console.error('登录失败:', error);
      toast.error('登录失败：' + (error.message || '用户名或密码错误'));
    } finally {
      setLoading(false);
    }
  };

  const handleRegister = async (data: RegisterFormData) => {
    setLoading(true);
    try {
      await signUp(data.username, data.password);
      toast.success('注册成功，请登录');
      setActiveTab('login');
      // 清空注册表单
      registerForm.reset();
    } catch (error: any) {
      console.error('注册失败:', error);
      toast.error('注册失败：' + (error.message || '用户名已存在'));
    } finally {
      setLoading(false);
    }
  };
```

## 第23页

```typescript
// 文件名: src/pages/Login.tsx (续)
// AI眼镜组件发布平台 V0.0.1 第23页

  return (
    <div className="min-h-screen bg-background flex items-center justify-center py-12 px-4">
      <div className="max-w-md w-full space-y-8">
        <Card>
          <CardHeader className="text-center">
            <CardTitle className="text-2xl">AI眼镜组件平台</CardTitle>q
            <CardDescription>
              {activeTab === 'login' ? '请登录您的账户' : '创建新账户'}
            </CardDescription>
          </CardHeader>
          
          <Tabs value={activeTab} onValueChange={setActiveTab}>
            <TabsList className="w-full grid grid-cols-2">
              <TabsTrigger value="login">登录</TabsTrigger>
              <TabsTrigger value="register">注册</TabsTrigger>
            </TabsList>
            
            <TabsContent value="login" className="mt-6">
              <form onSubmit={loginForm.handleSubmit(handleLogin)} className="space-y-4">
                <div className="space-y-2">
                  <Label htmlFor="login-username">用户名</Label>
                  <Input
                    id="login-username"
                    placeholder="请输入用户名"
                    {...loginForm.register('username')}
                    className={cn({
                      'border-destructive': loginForm.formState.errors.username,
                    })}
                    disabled={loading}
                  />
                  {loginForm.formState.errors.username && (
                    <p className="text-destructive text-sm">
                      {loginForm.formState.errors.username.message}
                    </p>
                  )}
                </div>
                
                <div className="space-y-2">
                  <Label htmlFor="login-password">密码</Label>
                  <Input
                    id="login-password"
                    type="password"
                    placeholder="请输入密码"
                    {...loginForm.register('password')}
                    className={cn({
                      'border-destructive': loginForm.formState.errors.password,
                    })}
                    disabled={loading}
                  />
                  {loginForm.formState.errors.password && (
                    <p className="text-destructive text-sm">
                      {loginForm.formState.errors.password.message}
                    </p>
                  )}
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
    );
  }
};

export default Login;
```

## 第30页（前30页结束）

```typescript
// 文件名: src/pages/AITools.tsx
// AI眼镜组件发布平台 V0.0.1 第30页

import { useState, useRef } from 'react';
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';
import { Input } from '@/components/ui/input';
import { Button } from '@/components/ui/button';
import { Textarea } from '@/components/ui/textarea';
import { Card, CardContent, CardHeader, CardTitle, CardDescription, CardFooter } from '@/components/ui/card';
import { MessageSquare, ImageIcon, Loader } from 'lucide-react';
import { toast } from 'sonner';

export default function AITools() {
  return (
    <div className="min-h-screen bg-background py-8">
      <div className="container mx-auto px-4">
        <h1 className="text-3xl font-bold text-foreground mb-8">AI助手</h1>
        
        <Tabs defaultValue="chat" className="w-full">
          <TabsList className="mb-6">
            <TabsTrigger value="chat" className="flex items-center gap-2">
              <MessageSquare className="h-4 w-4" />
              组件描述助手
            </TabsTrigger>
            <TabsTrigger value="image" className="flex items-center gap-2">
              <ImageIcon className="h-4 w-4" />
              封面图生成
            </TabsTrigger>
          </TabsList>
          
          <TabsContent value="chat">
            <ChatTab />
          </TabsContent>
          
          <TabsContent value="image">
            <ImageTab />
          </TabsContent>
        </Tabs>
      </div>
    </div>
  );
}

function ChatTab() {
  const [messages, setMessages] = useState<Array<{ role: 'user' | 'assistant'; content: string }>>([]);
  const [input, setInput] = useState('');
  const [loading, setLoading] = useState(false);
  const messagesEndRef = useRef<HTMLDivElement>(null);

  const scrollToBottom = () => {
    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
  };

  useEffect(() => {
    scrollToBottom();
  }, [messages]);

  const handleSend = async () => {
    if (!input.trim() || loading) return;

    const userMessage = { role: 'user' as const, content: input };
    setMessages(prev => [...prev, userMessage]);
    setInput('');
    setLoading(true);

    try {
      const response = await fetch('/api/spark-chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: input }),
      });

      if (!response.ok) throw new Error('请求失败');
      const data = await response.json();
      
      setMessages(prev => [...prev, { role: 'assistant' as const, content: data.content }]);
    } catch (error) {
      toast.error('AI回复失败，请重试');
      console.error('AI聊天错误:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === 'Enter' && !e.shiftKey) {
      e.preventDefault();
      handleSend();
    }
  };

  return (
    <Card className="overflow-hidden">
      <CardHeader>
        <CardTitle>组件描述助手</CardTitle>
        <CardDescription>
          使用AI帮助你生成专业的组件描述和文档
        </CardDescription>
      </CardHeader>
      <CardContent className="h-[500px] overflow-y-auto flex flex-col gap-4">
        {messages.length === 0 && (
          <div className="text-center text-muted-foreground py-8">
            输入组件相关信息，获取专业描述
          </div>
        )}
        {messages.map((message, index) => (
          <div key={index} className={`flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`}>
            <div className={`max-w-[80%] p-3 rounded-lg ${message.role === 'user' ? 'bg-primary text-primary-foreground' : 'bg-muted'}`}>
              {message.content}
            </div>
          </div>
        ))}
        {loading && (
          <div className="flex justify-start">
            <div className="max-w-[80%] p-3 rounded-lg bg-muted flex items-center gap-2">
              <Loader className="h-4 w-4 animate-spin" />
              AI正在思考...
            </div>
          </div>
        )}
        <div ref={messagesEndRef} />
      </CardContent>
      <CardFooter>
        <div className="flex w-full gap-2">
          <Textarea
            placeholder="请描述你的组件需求..."
            value={input}
            onChange={(e) => setInput(e.target.value)}
            onKeyDown={handleKeyDown}
            className="flex-1"
            disabled={loading}
          />
          <Button onClick={handleSend} disabled={loading}>
            发送
          </Button>
        </div>
      </CardFooter>
    </Card>
  );
}